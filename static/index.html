<!DOCTYPE html>
<html>
    <head>
        <title>Dandi Search Response Form</title>
        <link rel="stylesheet" type="text/css" href="styles.css">
        <script src="scripts/tabswitch.js"></script>
        <script src="scripts/viewresize.js"></script>
    </head>
    <body>
        <div class="container">
                <div class="leftFrame">
                    <img src="https://www.dandiarchive.org/handbook/img/dandi-logo-square_sw.png" style="margin-top: 50px;display:block;margin-left:auto;margin-right:auto;width:100px;margin-bottom:0;padding:0;margin-bottom:-20px;">
                    <div class="query-form">
                        <form id="scan-for-relevant-form">
                            <label style="font-weight: bold;">Query</label>
                            <br>
                            <textarea id="user-query" name="user-query" placeholder="e.g. Do any dandisets contain data relating to rat in maze experiments? "></textarea>
                            <br>
                            <button type="button" id="scan-button">Scan Dandi Archive</button>
                        </form>
                        <form id="choose-relevant-form">
                            <label id="choose-relevant-info"><b>Instructions:</b> Mark the checkboxes of any Dandisets that are relevant to the query chosen above. If none are relevant, please leave all checkboxes unchecked.</label>
                            <ul>
                                <li class="ds-checkbox select">
                                    <span class="ds-labels select">
                                        <label class="select ds-label" for="ds1">Option 1</label>
                                        <br>
                                        <label class="select ds-name" for="ds1">Option 1</label>
                                    </span>
                                    <input class="select ds-checkbox-icon" type="checkbox" id="ds1" name="ds1" value="">
                                </li>
                                <li class="ds-checkbox select">
                                    <span class="ds-labels select">
                                        <label class="select ds-label" for="ds2">Option 2</label>
                                        <br>
                                        <label class="select ds-name" for="ds2">Option 2</label>
                                    </span>
                                    <input class="select ds-checkbox-icon" type="checkbox" id="ds2" name="ds2" value="">
                                </li>
                                <li class="ds-checkbox select">
                                    <span class="ds-labels select">
                                        <label class="select ds-label" for="ds3">Option 3</label>
                                        <br>
                                        <label class="select ds-name" for="ds3">Option 3</label>
                                    </span>
                                    <input class="select ds-checkbox-icon" type="checkbox" id="ds3" name="ds3" value="">
                                </li>
                                <li class="ds-checkbox select">
                                    <span class="ds-labels select">
                                        <label class="select ds-label" for="ds4">Option 4</label>
                                        <br>
                                        <label class="select ds-name" for="ds4">Option 4</label>
                                    </span>
                                    <input class="select ds-checkbox-icon" type="checkbox" id="ds4" name="ds4" value="">
                                </li>
                                <li class="ds-checkbox select select">
                                    <span class="ds-labels select">
                                        <label class="select ds-label" for="ds5">Option 5</label>
                                        <br>
                                        <label class="select ds-name" for="ds5">Option 5</label>
                                    </span>
                                    <input class="select ds-checkbox-icon" type="checkbox" id="ds5" name="ds5" value="">
                                </li>
                                <li class="ds-checkbox select">
                                    <span class="ds-labels select">
                                        <label class="select ds-label" for="ds6">Option 6</label>
                                        <br>
                                        <label class="select ds-name" for="ds6">Option 6</label>
                                    </span>
                                    <input class="select ds-checkbox-icon" type="checkbox" id="ds6" name="ds6" value="">
                                </li>
                            </ul>
                            <br>
                            <button type="button" id="submit-button">Submit</button>
                        </form>
                    </div>
                    <div class="relevant-sets-form" id="relevant-sets-form"></div>
                </div>

                <iframe class="start-tab rightFrame" src="data:text/html;charset=utf-8,<html><head></head><body style='text-align:center;'><p style='font-family:sans-serif;display:flex;justify-content:center;align-items:center;height:100%;text-align:center;'>Choose a dandiset above to open a view<p></body></html>"></iframe>
                <iframe id="rf1" class="tab rightFrame" src=""></iframe>
                <iframe id="rf2" class="tab rightFrame" src=""></iframe>
                <iframe id="rf3" class="tab rightFrame" src=""></iframe>
                <iframe id="rf4" class="tab rightFrame" src=""></iframe>
                <iframe id="rf5" class="tab rightFrame" src=""></iframe>
                <iframe id="rf6" class="tab rightFrame" src=""></iframe>

                <div class="button-container">
                    <div class="button-row">
                        <button id="rf-b1" class="tabButton" onclick="showTab(0)"></button>
                        <button id="rf-b2" class="tabButton" onclick="showTab(1)"></button>
                        <button id="rf-b3" class="tabButton" onclick="showTab(2)"></button>
                    </div>
                    <div class="button-row">
                        <button id="rf-b4" class="tabButton" onclick="showTab(3)"></button>
                        <button id="rf-b5" class="tabButton" onclick="showTab(4)"></button>
                        <button id="rf-b6" class="tabButton" onclick="showTab(5)"></button>
                    </div>
                </div>  

                <!-- <button id="increase-left-size">&gt;</button>
                <button id="increase-right-size">&lt;</button> -->
        </div>  
        <script>
            document.getElementById("scan-button").addEventListener("click", async () => {
                var scan_button = document.getElementById("scan-button");
                scan_button.disabled = true;
                scan_button.textContent = "Scanning..."
                scan_button.style.cursor = "default";
                scan_button.style.background = "darkgreen";

                var text_area = document.getElementById("user-query");
                const user_query = text_area.value;
                
                const response = await fetch("/scan/", {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json",
                    },
                    body: JSON.stringify({ query: user_query }),
                });
                const result = await response.json();
                
                var iframes = document.querySelectorAll(".tab");
                var buttons = document.querySelectorAll(".tabButton");

                for (var i = 0; i < iframes.length; i++) {
                    iframes[i].src = `https://dandiarchive.org/dandiset/${result.ids[i]}`;
                    buttons[i].textContent = result.ids[i];
                }

                var button_container = document.querySelector(".button-container");
                var left_frame = document.querySelector(".leftFrame");
                var right_frame = document.querySelector(".rightFrame");
                
                left_frame.style.border = "1px black solid";
                button_container.style.display = "block";
                right_frame.style.display = "block";

                text_area.disabled = true;

                scan_button.style.display = "none";

                var choose_relevant_form = document.getElementById("choose-relevant-form");
                choose_relevant_form.style.display = "block";

                var ds_labels = document.querySelectorAll(".ds-label");
                var ds_checkboxes = document.querySelectorAll(".ds-checkbox-icon");
                var ds_names = document.querySelectorAll(".ds-name");
                for (var i = 0; i < ds_labels.length; i++) {
                    ds_labels[i].textContent = result.ids[i];
                    ds_checkboxes[i].value = result.ids[i];
                    ds_names[i].textContent = result.names[i];
                }
            })
        </script>   
        <script>
            document.addEventListener("DOMContentLoaded", function () {
                const listItems = document.querySelectorAll(".ds-checkbox");

                listItems.forEach(function (listItem) {
                    const checkbox = listItem.querySelector('input[type="checkbox"]');
                    
                    listItem.addEventListener("click", function (event) {
                        if (event.target !== checkbox) {
                            checkbox.checked = !checkbox.checked;
                        }
                    });
                });
            });
        </script>
    </body>
</html>